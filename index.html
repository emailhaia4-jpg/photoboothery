<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> Sticker Photobooth‚ú®</title>
<style>
  body { font-family:'Comic Sans MS', cursive,sans-serif; text-align:center; background:linear-gradient(135deg,#ffdde1,#ee9ca7); color:#fff; margin:0; padding:0; }
  h1 { font-size:2em; margin-top:20px; text-shadow:2px 2px #ff7b9c; }
  #video, canvas { border-radius:15px; border:5px solid white; box-shadow:0 4px 10px rgba(0,0,0,0.2); width:90%; max-width:400px; margin:10px 0; position:relative; }
  button { font-size:1em; padding:10px 20px; margin:10px; border-radius:30px; border:none; background:#ff7b9c; color:white; cursor:pointer; transition:0.3s; }
  button:hover { background:#ff4b6b; transform:scale(1.05); }
  select, .sticker-checkbox, .addSticker { padding:8px; font-size:1em; border-radius:10px; border:none; background:white; color:#ff4b6b; margin:5px 5px 10px 0; cursor:pointer;}
  #countdown { font-size:3em; font-weight:bold; margin-top:10px; text-shadow:3px 3px #ff4b6b; animation:pop 0.3s; }
  @keyframes pop {0%{transform:scale(0);}50%{transform:scale(1.5);}100%{transform:scale(1);}}
  #canvasContainer { display:flex; justify-content:center; margin-top:20px; position:relative; }
  .sticker { width:60px; height:60px; position:absolute; cursor:move; user-select:none; animation:float 2s infinite alternate;}
  @keyframes float {0%{transform:translateY(0);}100%{transform:translateY(-10px);}}
</style>
</head>
<body>

<h1>‚ú®Animated Sticker Photobooth‚ú®</h1>

<label for="frameSelect">Frame:</label>
<select id="frameSelect">
  <option value="none">None</option>
  <option value="pink">Pink</option>
  <option value="stars">Stars</option>
  <option value="hearts">Hearts</option>
</select>

<div>
  <span>Add Stickers:</span>
  <button class="addSticker" data-sticker="heart">‚ù§Ô∏è</button>
  <button class="addSticker" data-sticker="star">‚≠ê</button>
  <button class="addSticker" data-sticker="smile">üòä</button>
</div>

<div>
  <span>Filters:</span>
  <button class="filterBtn" data-filter="none">None</button>
  <button class="filterBtn" data-filter="bw">B&W</button>
  <button class="filterBtn" data-filter="sepia">Sepia</button>
  <button class="filterBtn" data-filter="sparkle">‚ú®Sparkle‚ú®</button>
</div>

<div id="canvasContainer">
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none;"></canvas>
</div>

<div id="countdown"></div>

<div>
  <button id="startBtn">Start üì∑</button>
  <button id="retakeBtn" style="display:none;">Retake üîÑ</button>
  <button id="downloadBtn" style="display:none;">Download Strip üíæ</button>
</div>

<audio id="shutter" src="https://www.soundjay.com/camera/camera-shutter-click-01.mp3" preload="auto"></audio>

<script>
const video=document.getElementById('video');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const countdownEl=document.getElementById('countdown');
const startBtn=document.getElementById('startBtn');
const retakeBtn=document.getElementById('retakeBtn');
const downloadBtn=document.getElementById('downloadBtn');
const frameSelect=document.getElementById('frameSelect');
const addStickerBtns=document.querySelectorAll('.addSticker');
const filterButtons=document.querySelectorAll('.filterBtn');
const shutterSound=document.getElementById('shutter');

let photos=[];
let currentPhoto=0;
let selectedFilter='none';
let stickersOnVideo=[];

const frames={pink:'https://i.imgur.com/2yafKbl.png', stars:'https://i.imgur.com/IHdD3bL.png', hearts:'https://i.imgur.com/l1UBACJ.png'};
const stickers={heart:'https://i.imgur.com/7KZJQqZ.png', star:'https://i.imgur.com/Z6w6rjx.png', smile:'https://i.imgur.com/QXWx0mj.png'};

navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{video.srcObject=stream;}).catch(err=>{alert("Camera denied");console.error(err);});

filterButtons.forEach(btn=>{btn.addEventListener('click',()=>{selectedFilter=btn.dataset.filter;});});

addStickerBtns.forEach(btn=>{
  btn.addEventListener('click',()=>{
    const s=document.createElement('img');
    s.src=stickers[btn.dataset.sticker];
    s.className='sticker';
    s.style.left='50px';
    s.style.top='50px';
    document.getElementById('canvasContainer').appendChild(s);
    stickersOnVideo.push(s);
    dragElement(s);
  });
});

function dragElement(el){
  let offsetX=0, offsetY=0, mouseX=0, mouseY=0;
  el.onmousedown=function(e){
    e.preventDefault(); mouseX=e.clientX; mouseY=e.clientY;
    document.onmousemove=dragMouseMove; document.onmouseup=closeDrag;
  };
  function dragMouseMove(e){
    e.preventDefault();
    offsetX=mouseX-e.clientX;
    offsetY=mouseY-e.clientY;
    mouseX=e.clientX;
    mouseY=e.clientY;
    el.style.top=(el.offsetTop-offsetY)+'px';
    el.style.left=(el.offsetLeft-offsetX)+'px';
  }
  function closeDrag(){ document.onmouseup=null; document.onmousemove=null; }
}

function startCountdown(){let c=3; countdownEl.textContent=c; startBtn.disabled=true; const t=setInterval(()=>{c--; countdownEl.textContent=c>0?c:""; if(c===0){clearInterval(t); takePhoto();}},1000);}

function applyFilter(){switch(selectedFilter){case 'bw':ctx.filter='grayscale(100%)';break;case 'sepia':ctx.filter='sepia(80%)';break;case 'sparkle':ctx.filter='contrast(120%) brightness(120%)';break;default:ctx.filter='none';}}

function takePhoto(){
  shutterSound.play();
  const tempCanvas=document.createElement('canvas'); tempCanvas.width=video.videoWidth; tempCanvas.height=video.videoHeight;
  const tempCtx=tempCanvas.getContext('2d'); tempCtx.drawImage(video,0,0,tempCanvas.width,tempCanvas.height);
  applyFilter();
  let frame=frameSelect.value;
  if(frame!=='none'){ let f=new Image(); f.src=frames[frame]; f.onload=()=>{ tempCtx.drawImage(f,0,0,tempCanvas.width,tempCanvas.height); drawStickers(tempCtx,tempCanvas); };} else drawStickers(tempCtx,tempCanvas);
}

function drawStickers(tempCtx,tempCanvas){
  stickersOnVideo.forEach(s=>{ let x=parseInt(s.style.left); let y=parseInt(s.style.top); let img=new Image(); img.src=s.src; img.onload=()=>{ tempCtx.drawImage(img,x,y,60,60); } });
  savePhoto(tempCanvas);
}

function savePhoto(pc){ photos[currentPhoto]=pc.toDataURL(); currentPhoto++;
  if(currentPhoto<4){ countdownEl.textContent=`Photo ${currentPhoto} taken! Next in 1s`; setTimeout(()=>{countdownEl.textContent=""; startBtn.disabled=false;},1000);}
  else showFinalStrip();
}

function showFinalStrip(){ canvas.width=300; canvas.height=300*4; ctx.fillStyle="#fff"; ctx.fillRect(0,0,canvas.width,canvas.height);
  photos.forEach((src,i)=>{ let img=new Image(); img.src=src; img.onload=()=>ctx.drawImage(img,0,i*300,300,300);});
  video.style.display="none"; canvas.style.display="block"; startBtn.style.display="none"; retakeBtn.style.display="inline-block"; downloadBtn.style.display="inline-block"; countdownEl.textContent="";
}

function retakePhoto(){ if(currentPhoto>0){ currentPhoto--; photos.pop(); canvas.style.display="none"; video.style.display="block"; startBtn.style.display="inline-block"; retakeBtn.style.display="none"; downloadBtn.style.display="none"; }}

function downloadPhoto(){ const link=document.createElement('a'); link.download='photobooth-strip.png'; link.href=canvas.toDataURL(); link.click(); }

startBtn.addEventListener('click',startCountdown);
retakeBtn.addEventListener('click',retakePhoto);
downloadBtn.addEventListener('click',downloadPhoto);
</script>
</body>
</html>
